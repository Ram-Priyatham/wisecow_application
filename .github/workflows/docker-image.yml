name: CI/CD

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Install kubectl
      run: |
        curl -LO "https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x ./kubectl
        sudo mv ./kubectl /usr/local/bin/kubectl
    - name: Set up kubeconfig
      env:
        KUBE_CONFIG: ${{ secrets.KUBE_CONFIG }}
      run: |
        echo "${{ secrets.KUBE_CONFIG }}" | base64 --decode > $GITHUB_WORKSPACE/config
        cat $GITHUB_WORKSPACE/config
    - name: Deploy to Kubernetes
      env:
        KUBECONFIG: $GITHUB_WORKSPACE/config
      run: |
        kubectl cluster-info 
        kubectl apply -f k8/deployment.yaml
        kubectl apply -fÂ k8/service.yaml
